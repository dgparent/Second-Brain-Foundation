# NextGen Phases Enhancement Addendum

**Document Type:** Sanity Check Enhancement Additions  
**Generated:** December 28, 2025  
**Generated By:** BMad Orchestrator Party Mode - Sanity Check V2  

---

## Purpose

This addendum contains enhancement comments, blind spot mitigations, and additional tasks that should be incorporated into each phase document. Rather than directly modifying the original phase documents (which would create version control complexity), this addendum serves as a companion document.

**Reference this document alongside** the corresponding phase when implementing.

---

## Phase 00 Enhancements

### Additional Tasks to Add

| ID | Task | Effort | Rationale |
|----|------|--------|-----------|
| 00.X.1 | Add SHA-256 checksum generation to BaseEntity | 4h | PRD FR24 requires content integrity |
| 00.X.2 | Implement confidence_score field on BaseEntity | 2h | PRD FR25 requires confidence tracking |
| 00.X.3 | Add default sensitivity="personal" to BaseEntity | 2h | PRD FR16 requires default personal |
| 00.X.4 | Create relationship_types table schema | 3h | PRD FR11-12 typed relationships |
| 00.X.5 | Add tenant-level privacy preferences table | 2h | Supports Phase 10 |

### Blind Spots Identified

1. **No Entity Type System Foundation**
   - **Issue:** BaseEntity doesn't support typed entities (person, topic, project)
   - **Mitigation:** Add `entity_type` enum and registry pattern to BaseEntity
   - **Implementation:**
   ```typescript
   export enum EntityType {
     NOTE = 'note',
     PERSON = 'person',
     PLACE = 'place',
     TOPIC = 'topic',
     PROJECT = 'project',
     TRANSITIONAL = 'transitional',
   }
   ```

2. **No UID Generation Pattern**
   - **Issue:** PRD FR10 requires `{type}-{slug}-{counter}` format
   - **Mitigation:** Add UIDGenerator utility to domain-base
   - **See:** Phase 09 UIDGenerator implementation

3. **Missing Lifecycle State Machine**
   - **Issue:** 48-hour lifecycle per PRD FR13-14 not addressed
   - **Mitigation:** Add lifecycle_state enum to BaseEntity
   - **See:** Phase 09 LifecycleStateMachine

### Integration Points

- **‚Üí Phase 09:** Entity Framework builds on BaseEntity patterns
- **‚Üí Phase 10:** Sensitivity defaults set here, expanded in Phase 10

---

## Phase 01 Enhancements

### Additional Tasks to Add

| ID | Task | Effort | Rationale |
|----|------|--------|-----------|
| 01.X.1 | Add Ollama provider for local AI | 4h | Privacy-first local processing |
| 01.X.2 | Implement AI access permission checking | 6h | PRD FR18-19 context permissions |
| 01.X.3 | Add token tracking per-entity basis | 4h | Cost allocation to sources |
| 01.X.4 | Implement model selection by sensitivity | 3h | Confidential ‚Üí local only |

### Blind Spots Identified

1. **No Local AI Support**
   - **Issue:** All models are cloud-based, violates privacy requirements
   - **Mitigation:** Add Ollama provider in ModelManager
   - **Implementation:**
   ```typescript
   case 'ollama':
     return new OllamaProvider(model);
   ```

2. **No Sensitivity-Based Model Selection**
   - **Issue:** Confidential content requires local-only models
   - **Mitigation:** Add `getModelBySensitivity(tenantId, type, sensitivity)` method
   - **Logic:** If sensitivity >= confidential, only return local models

3. **Missing Batch Processing for Large Vaults**
   - **Issue:** Ingesting 1000+ sources will overwhelm system
   - **Mitigation:** Add queue-based ingestion with rate limiting
   - **See:** Phase 00 background job system

### Integration Points

- **‚Üí Phase 10:** AI access checking integrates with SensitivityService
- **‚Üí Phase 11:** CLI tool uses ModelManager for chat

---

## Phase 02 Enhancements

### Additional Tasks to Add

| ID | Task | Effort | Rationale |
|----|------|--------|-----------|
| 02.X.1 | Add entity type to Source model | 2h | PRD entity framework |
| 02.X.2 | Implement YAML frontmatter parsing | 4h | PRD FR6-9 templates |
| 02.X.3 | Add lifecycle state tracking to Source | 2h | PRD FR13-14 |
| 02.X.4 | Implement wikilink extraction from content | 4h | PRD FR11 relationships |

### Blind Spots Identified

1. **Source ‚â† Entity Separation**
   - **Issue:** "Source" is used but PRD defines "Entity" with types
   - **Mitigation:** Rename or create Entity model that wraps Source
   - **See:** Phase 09 Entity model

2. **No Folder Hierarchy for Sources**
   - **Issue:** PRD FR1-5 requires Daily/People/Places/Topics/Projects/Transitional
   - **Mitigation:** Add folder_path field, enforce hierarchy on creation

3. **Missing Relationship Extraction**
   - **Issue:** Wikilinks in content not parsed
   - **Mitigation:** Add WikilinkExtractor service
   - **See:** Phase 11 WikilinkResolver

### Integration Points

- **‚Üí Phase 09:** Entity model extends Source with PRD features
- **‚Üí Phase 11:** Obsidian sync uses folder hierarchy

---

## Phase 03 Enhancements

### Additional Tasks to Add

| ID | Task | Effort | Rationale |
|----|------|--------|-----------|
| 03.X.1 | Add sensitivity filtering to RAG context | 4h | PRD FR18 context permissions |
| 03.X.2 | Include entity relationships in context window | 4h | Graph-aware retrieval |
| 03.X.3 | Add BMOM context to prompts when available | 3h | PRD FR18-19 BMOM framework |
| 03.X.4 | Implement citation confidence scoring | 4h | PRD FR25 confidence |

### Blind Spots Identified

1. **No Privacy-Aware RAG**
   - **Issue:** RAG retrieves all chunks regardless of sensitivity
   - **Mitigation:** Add sensitivity filter to context builder
   - **See:** Phase 10 SensitivityFilter

2. **No Graph-Aware Retrieval**
   - **Issue:** Related entities not considered in context
   - **Mitigation:** After vector search, expand to related entities
   - **Implementation:**
   ```typescript
   // After getting initial chunks
   const relatedUids = await EntityRelationship.findRelated(chunkUids);
   const relatedChunks = await Chunk.findByEntityUids(relatedUids);
   context.push(...relatedChunks);
   ```

3. **Citation Confidence Missing**
   - **Issue:** Citations show but no confidence indicator
   - **Mitigation:** Add confidence_score to citation response
   - **See:** Phase 09 ConfidenceScorer

### Integration Points

- **‚Üí Phase 09:** BMOM context and confidence scoring
- **‚Üí Phase 10:** Sensitivity filtering in RAG

---

## Phase 04 Enhancements

### Additional Tasks to Add

| ID | Task | Effort | Rationale |
|----|------|--------|-----------|
| 04.X.1 | Add lifecycle-aware transformations | 3h | Different prompts for fleeting vs evergreen |
| 04.X.2 | Implement transformation confidence scoring | 4h | PRD FR25 |
| 04.X.3 | Add BMOM extraction transformation | 6h | PRD FR18-19 |
| 04.X.4 | Create relationship extraction transformation | 6h | PRD FR11-12 |

### Blind Spots Identified

1. **No BMOM Extraction**
   - **Issue:** Transformations don't extract Because-Meaning-Outcome-Measure
   - **Mitigation:** Add BMOMExtractor transformation type
   - **See:** Phase 09 BMOMExtractor

2. **No Lifecycle Transition Trigger**
   - **Issue:** After 48 hours fleeting ‚Üí summarize transformation should trigger
   - **Mitigation:** Add lifecycle hook in transformation runner
   - **See:** Phase 09 LifecycleStateMachine

3. **Missing Relationship Extraction**
   - **Issue:** Transformations don't extract entity mentions
   - **Mitigation:** Add EntityMentionExtractor transformation
   - **Implementation:**
   ```typescript
   const EXTRACTION_PROMPT = `Extract all mentions of:
   - People (names, roles, titles)
   - Places (locations, addresses)
   - Topics (concepts, themes)
   - Projects (initiatives, tasks)
   Return as JSON array.`;
   ```

### Integration Points

- **‚Üí Phase 09:** Lifecycle triggers transformation
- **‚Üí Phase 07:** Entity extraction feeds knowledge graph

---

## Phase 05 Enhancements

### Additional Tasks to Add

| ID | Task | Effort | Rationale |
|----|------|--------|-----------|
| 05.X.1 | Add sensitivity check before TTS | 3h | Secret content no audio |
| 05.X.2 | Include BMOM section in podcast script | 4h | Richer context |
| 05.X.3 | Add podcast generation confidence score | 2h | PRD FR25 |
| 05.X.4 | Support multiple podcast formats | 4h | Deep dive, news brief, etc. |

### Blind Spots Identified

1. **Podcast from Secret Content**
   - **Issue:** No check prevents podcasting secret content
   - **Mitigation:** Block podcast generation for secret sensitivity
   - **See:** Phase 10 AIAccessControl

2. **Single Format Only**
   - **Issue:** Only one podcast style
   - **Mitigation:** Add format parameter (deep_dive, news_brief, interview)
   - **Templates:** Different prompts per format

3. **No Source Confidence in Script**
   - **Issue:** Podcast doesn't indicate source reliability
   - **Mitigation:** Include confidence when introducing sources
   - **Script:** "According to a highly-rated source..." vs "One source suggests..."

### Integration Points

- **‚Üí Phase 10:** Sensitivity checking before audio generation
- **‚Üí Phase 09:** Confidence scoring affects podcast script

---

## Phase 06 Enhancements

### Additional Tasks to Add

| ID | Task | Effort | Rationale |
|----|------|--------|-----------|
| 06.X.1 | Add sensitivity badge to source list | 2h | UI visibility |
| 06.X.2 | Show lifecycle state in source cards | 2h | PRD FR13-14 |
| 06.X.3 | Add bulk sensitivity update UI | 4h | Phase 10 integration |
| 06.X.4 | Show confidence score on sources | 2h | PRD FR25 |
| 06.X.5 | Add entity type picker on create | 2h | PRD entity framework |

### Blind Spots Identified

1. **No Entity Type Selection**
   - **Issue:** Create source doesn't ask for entity type
   - **Mitigation:** Add entity type dropdown (note, person, topic, etc.)
   - **Default:** Auto-detect from content if possible

2. **No Lifecycle Indicators**
   - **Issue:** Users can't see fleeting/maturing/evergreen state
   - **Mitigation:** Add badge or icon showing lifecycle state
   - **Visual:** üå± fleeting, üåø maturing, üå≥ evergreen

3. **Missing Relationship Visualization**
   - **Issue:** No way to see entity relationships in UI
   - **Mitigation:** Add "Related" tab or section
   - **See:** Phase 07 knowledge graph visualization

### Integration Points

- **‚Üí Phase 09:** Entity type and lifecycle UI elements
- **‚Üí Phase 10:** Sensitivity picker and badges
- **‚Üí Phase 07:** Relationship visualization

---

## Phase 07 Enhancements

### Additional Tasks to Add

| ID | Task | Effort | Rationale |
|----|------|--------|-----------|
| 07.X.1 | Add typed relationship edges | 4h | PRD FR11-12 vocabulary |
| 07.X.2 | Filter graph by sensitivity | 3h | Secret nodes hidden |
| 07.X.3 | Show BMOM in node details | 2h | PRD FR18-19 |
| 07.X.4 | Add confidence coloring to nodes | 2h | Visual confidence |

### Blind Spots Identified

1. **No Typed Relationships**
   - **Issue:** All edges are generic "related"
   - **Mitigation:** Use PRD vocabulary: related_to, mentioned, cited_by, inspired_by
   - **Visual:** Different colors/styles per relationship type

2. **Secret Nodes Visible**
   - **Issue:** Secret content shows in graph
   - **Mitigation:** Filter out secret sensitivity from graph data
   - **See:** Phase 10 SensitivityFilter

3. **No Temporal View**
   - **Issue:** Graph is static, no time dimension
   - **Mitigation:** Add timeline slider to show knowledge growth
   - **Enhancement:** Animate graph evolution over time

### Integration Points

- **‚Üí Phase 09:** Entity relationships define graph edges
- **‚Üí Phase 10:** Sensitivity filtering hides secret nodes

---

## Phase 08 Enhancements

### Additional Tasks to Add

| ID | Task | Effort | Rationale |
|----|------|--------|-----------|
| 08.X.1 | Add privacy audit log volume | 2h | Phase 10 support |
| 08.X.2 | Configure local AI container | 4h | Ollama for privacy |
| 08.X.3 | Add sensitivity to health checks | 2h | Verify no secret leaks |
| 08.X.4 | Set up CLI deployment | 3h | Phase 11 support |

### Blind Spots Identified

1. **No Local AI Container**
   - **Issue:** Docker Compose only has cloud AI
   - **Mitigation:** Add Ollama service to docker-compose
   - **Implementation:**
   ```yaml
   ollama:
     image: ollama/ollama:latest
     ports:
       - "11434:11434"
     volumes:
       - ollama_data:/root/.ollama
   ```

2. **No Privacy Audit in Monitoring**
   - **Issue:** Grafana doesn't show privacy metrics
   - **Mitigation:** Add dashboard for privacy audit log
   - **Metrics:** Blocked AI requests, sensitivity changes, export attempts

3. **Missing CLI in Deployment**
   - **Issue:** CI/CD doesn't publish CLI package
   - **Mitigation:** Add npm publish step for @sbf/cli
   - **See:** Phase 11 CLI deployment

### Integration Points

- **‚Üí Phase 10:** Privacy audit log infrastructure
- **‚Üí Phase 11:** CLI deployment pipeline

---

## Cross-Phase Integration Matrix

| From Phase | To Phase | Integration Point |
|------------|----------|-------------------|
| 00 | 09 | BaseEntity ‚Üí Entity with types |
| 00 | 10 | Default sensitivity field |
| 01 | 10 | AI provider ‚Üí sensitivity check |
| 02 | 09 | Source ‚Üí Entity mapping |
| 02 | 11 | Folder structure ‚Üí Obsidian sync |
| 03 | 10 | RAG ‚Üí sensitivity filter |
| 04 | 09 | Transformation ‚Üí lifecycle trigger |
| 05 | 10 | Podcast ‚Üí sensitivity check |
| 06 | 09 | UI ‚Üí entity type picker |
| 06 | 10 | UI ‚Üí sensitivity badge |
| 07 | 09 | Graph ‚Üí typed relationships |
| 07 | 10 | Graph ‚Üí secret node filtering |
| 08 | 10 | Infra ‚Üí audit logging |
| 08 | 11 | Infra ‚Üí CLI deployment |

---

## Recommended Implementation Order

Given the dependencies identified, the recommended order to implement enhancements:

1. **Phase 00 additions first** - Foundation for entity types, sensitivity, checksum
2. **Phase 09 complete** - Entity framework enables all other features
3. **Phase 10 complete** - Privacy system blocks must be in place
4. **Phase 01-02 additions** - AI and ingestion can now respect privacy
5. **Phase 03-04 additions** - RAG and transformations use new systems
6. **Phase 05-07 additions** - Features can use entity/privacy systems
7. **Phase 08 additions** - Infrastructure supports all new features
8. **Phase 11 complete** - Integrations can use complete system

---

## Quick Reference: PRD Requirements Coverage

| PRD Requirement | Original Phase | Now Covered In |
|-----------------|----------------|----------------|
| FR1-5 (Folder Hierarchy) | ‚ùå None | Phase 09, 11 |
| FR6-9 (Entity Templates) | ‚ùå None | Phase 09 |
| FR10 (UID Generation) | ‚ùå None | Phase 09 |
| FR11-12 (Relationships) | Partial Phase 07 | Phase 09, 07 enhanced |
| FR13-14 (48hr Lifecycle) | ‚ùå None | Phase 09 |
| FR15-17 (Sensitivity) | ‚ùå None | Phase 10 |
| FR18-19 (BMOM) | ‚ùå None | Phase 09 |
| FR20-21 (AI Permissions) | ‚ùå None | Phase 10 |
| FR24 (Checksum) | ‚ùå None | Phase 00 enhanced |
| FR25 (Confidence) | ‚ùå None | Phase 09 |

---

*Generated by BMad Orchestrator Party Mode - Sanity Check V2*  
*This addendum should be reviewed alongside each phase during implementation.*
